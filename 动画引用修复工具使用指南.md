# 带动画的物体名称修改器使用指南

## 问题背景

在Unity开发过程中，经常会遇到以下情况：
1. 创建了一个GameObject的子物体
2. 为这个子物体设置了名称（比如"OldName"）
3. 使用Animation窗口为这个子物体创建了动画，插入了关键帧
4. 后来想要修改子物体的名称（比如改为"NewName"）
5. 但是担心修改后动画中的引用会丢失，动画无法正常播放

这是因为Unity的动画系统通过**路径字符串**来引用GameObject，当物体名称改变时，路径也会改变，导致引用失效。

## 工具解决方案

我们的带动画的物体名称修改器可以同时完成以下操作：
1. **安全地重命名GameObject**：使用Unity的Undo系统，支持撤销操作
2. **自动修复动画引用**：扫描并更新所有相关动画中的路径引用
3. **递归处理子物体**：可选择同时重命名所有同名的子物体
4. **预览功能**：在执行前可以预览所有将要进行的修改

这样你就可以放心地重命名物体，而不用担心动画引用丢失的问题。

## 详细使用步骤

### 第一步：打开工具

在Unity编辑器中，点击菜单栏：
```
工具 > 带动画的物体名称修改器
```

### 第二步：设置目标物体

1. 在"目标物体"字段中，拖入要重命名的GameObject
   - 这可以是任何GameObject，不一定要有动画组件
   - 工具会自动扫描该物体及其子物体中的所有动画组件
   - 如果没有找到动画，工具仍然可以重命名物体

### 第三步：输入名称信息

1. **当前物体名称**：输入要重命名的物体的当前名称
   - 工具会自动填充选中物体的名称
   - 你也可以手动输入，用于重命名特定名称的子物体

2. **新物体名称**：输入想要设置的新名称
   - 这是重命名后的目标名称
   - 确保新名称符合Unity的命名规范

### 第四步：配置搜索选项

1. **搜索子物体动画**：
   - 勾选此选项会搜索目标物体的所有子物体中的动画
   - 如果只想搜索目标物体本身的动画，可以取消勾选
   - 推荐保持勾选，确保找到所有相关动画

### 第五步：预览修改

1. 点击"预览修改"按钮
2. 工具会显示：
   - 将要重命名的GameObject信息
   - 找到的动画剪辑数量
   - 每个剪辑中需要修复的引用详情
   - 修改前后的路径对比

**预览结果示例：**
```
动画剪辑: PlayerWalk
  路径: Player/OldName -> Player/NewName
  属性: m_LocalPosition.x
  路径: Player/OldName -> Player/NewName
  属性: m_LocalRotation.z
  找到 2 个需要修复的引用

动画剪辑: PlayerIdle
  路径: Player/OldName -> Player/NewName
  属性: m_LocalScale.x
  找到 1 个需要修复的引用
```

### 第六步：执行修改

1. 确认预览结果无误后，点击"执行修改"按钮
2. 系统会弹出确认对话框，再次确认修改操作
3. 点击"确认"开始执行
4. 工具会依次执行：
   - 重命名GameObject（支持撤销）
   - 修复动画引用
   - 保存修改的资源
5. 完成后会显示成功消息

## 技术原理

### 动画路径系统

Unity的动画系统使用层级路径来引用GameObject：
```
// 示例路径
"Player/Weapon/Gun"  // 表示Player下的Weapon下的Gun物体
"UI/Canvas/Button"   // 表示UI下的Canvas下的Button物体
```

### 修改过程

1. **重命名阶段**：
   - 使用Unity的Undo系统记录操作
   - 重命名目标GameObject
   - 递归重命名所有匹配的子物体
   - 标记场景为已修改

2. **扫描阶段**：
   - 遍历目标物体及其子物体的所有Animator和Animation组件
   - 提取所有AnimationClip
   - 分析每个剪辑中的EditorCurveBinding

3. **匹配阶段**：
   - 检查每个绑定的路径是否包含旧物体名称
   - 记录所有匹配的绑定信息

4. **修复阶段**：
   - 获取原始的AnimationCurve或ObjectReferenceKeyframe
   - 创建新的EditorCurveBinding，替换路径中的物体名称
   - 删除旧绑定，添加新绑定
   - 保存修改到资源文件

### 支持的绑定类型

- **属性曲线**：Transform、Renderer、Collider等组件的属性
- **对象引用曲线**：Sprite、Material、AudioClip等资源引用

## 常见问题解答

### Q: 工具找不到我的动画剪辑？

A: 请检查：
1. 目标物体是否包含Animator或Animation组件
2. 动画剪辑是否正确关联到控制器或组件
3. 旧物体名称是否输入正确（区分大小写）

### Q: 修复后动画还是不工作？

A: 可能的原因：
1. 物体的层级结构发生了变化（不仅仅是名称）
2. 组件被删除或类型发生变化
3. 存在多个同名物体导致路径冲突

### Q: 可以撤销修改操作吗？

A: 部分可以撤销：
1. **GameObject重命名**：可以通过Unity的撤销系统（Ctrl+Z）恢复
2. **动画引用修改**：会直接修改动画资源文件，无法撤销

建议：
1. 修改前备份项目
2. 使用版本控制系统（如Git）
3. 仔细检查预览结果

### Q: 工具会影响其他动画吗？

A: 不会。工具只会：
1. 重命名指定的GameObject
2. 修改包含指定旧名称的动画路径
3. 其他动画引用保持不变

## 最佳实践

1. **命名规范**：建立清晰的GameObject命名规范，减少后期修改需求
2. **版本控制**：使用Git等版本控制系统，便于回滚操作
3. **分阶段修复**：如果有大量动画需要修复，建议分批处理
4. **测试验证**：修复后及时测试动画播放效果

## 新增功能特性

相比传统的手动重命名，本工具提供：
- **安全重命名**：使用Unity的Undo系统，支持撤销
- **自动填充**：自动填充当前物体名称，减少输入错误
- **递归处理**：可选择同时处理所有同名子物体
- **预览功能**：在执行前查看所有将要进行的修改
- **智能检测**：自动检测是否需要修复动画引用

## 扩展功能

未来版本可能添加的功能：
- 批量处理多个物体名称
- 支持正则表达式匹配
- 路径重映射功能
- 自动备份和恢复功能
- 支持Prefab中的动画引用修复

## 技术支持

如果在使用过程中遇到问题，请：
1. 检查Unity控制台的错误信息
2. 确认工具的使用步骤是否正确
3. 提供具体的错误场景和复现步骤